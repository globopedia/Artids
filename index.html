<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador Hurac치n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      color: #000;
      margin: 0;
      padding: 20px;
    }
    .buscador-wrapper {
      max-width: 800px;
      margin: 0 auto 20px auto;
      text-align: center;
    }
    #buscador {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #DA291C;
      border-radius: 8px;
    }
    .filtros {
      margin-top: 15px;
    }
    .filtro-btn, .condicion-btn {
      padding: 8px 12px;
      margin: 3px;
      border: 2px solid #DA291C;
      border-radius: 8px;
      background: #fff;
      color: #DA291C;
      cursor: pointer;
    }
    .inactivo {
      opacity: 0.5;
      filter: grayscale(100%);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    td {
      border-bottom: 1px solid #ccc;
      padding: 10px;
      vertical-align: top;
    }
    mark {
      background: yellow;
      padding: 0 2px;
    }
  </style>
</head>
<body>
  <div class="buscador-wrapper">
    <h1>Encuentros de Hurac치n</h1>
    <input type="text" id="buscador" placeholder="Buscar..." />

    <!-- 游댷 Filtro din치mico de rivales -->
    <div style="margin: 20px auto; max-width: 400px;">
      <label for="filtro-rival"><strong>Rival:</strong></label>
      <select id="filtro-rival">
        <option value="" selected>Todos los rivales</option>
      </select>
    </div>

    <!-- filtros de competiciones / condiciones -->
    <div class="filtros">
      <button class="filtro-btn" data-tipo="Copa Libertadores">Copa Libertadores</button>
      <button class="filtro-btn" data-tipo="Torneo Local">Torneo Local</button>
      <!-- m치s botones de competiciones -->
    </div>
    <div class="filtros">
      <button class="condicion-btn" data-condicion="Local">Local</button>
      <button class="condicion-btn" data-condicion="Visitante">Visitante</button>
      <button class="condicion-btn" data-condicion="Neutral">Neutral</button>
    </div>
  </div>

  <table>
    <tbody id="tabla-cuerpo"></tbody>
  </table>
  <p id="mensaje-vacio" style="display:none; text-align:center;">丘멆잺 No hay resultados para mostrar</p>

  <script>
    async function cargarCSV() {
      const url = "https://raw.githubusercontent.com/globopedia/Rivales-Huracan/main/Encuentros_Huracan.csv";
      const response = await fetch(url);
      const data = await response.text();
      return data.trim().split("\n").slice(1); // quitamos encabezado
    }

    async function cargarCSVClubes() {
      const url = "https://raw.githubusercontent.com/globopedia/Rivales-Huracan/main/clubes.csv";
      const response = await fetch(url);
      const data = await response.text();
      const lineas = data.trim().split("\n").slice(1);
      return lineas.map(linea => {
        const partes = linea.split(";");
        return partes[0].replace(/^"(.*)"$/, "$1"); // columna CLUB
      });
    }

    function mostrarFilas(filas, filtroTexto, filtrosActivos, condicionesActivas, rivalSeleccionado) {
      const cuerpo = document.getElementById("tabla-cuerpo");
      const mensaje = document.getElementById("mensaje-vacio");
      cuerpo.innerHTML = "";

      if (filtroTexto === "" && !rivalSeleccionado) {
        mensaje.style.display = "block";
        return;
      }

      const filtradas = filas.filter(fila => {
        const textoLower = fila.toLowerCase();
        const coincideTexto = filtroTexto ? textoLower.includes(filtroTexto.toLowerCase()) : true;
        const coincideFiltro = filtrosActivos.length > 0 ? filtrosActivos.some(tipo => textoLower.includes(tipo.toLowerCase())) : true;
        const coincideCondicion = condicionesActivas.length > 0 ? condicionesActivas.some(cond => textoLower.includes(cond.toLowerCase())) : true;
        const coincideRival = rivalSeleccionado ? textoLower.includes(rivalSeleccionado.toLowerCase()) : true;
        return coincideTexto && coincideFiltro && coincideCondicion && coincideRival;
      });

      if (filtradas.length === 0) {
        mensaje.style.display = "block";
      } else {
        mensaje.style.display = "none";
        filtradas.forEach(fila => {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.innerHTML = fila.replace(/;/g, "<br>");
          tr.appendChild(td);
          cuerpo.appendChild(tr);
        });
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const filas = await cargarCSV();
      const buscador = document.getElementById("buscador");
      const filtros = document.querySelectorAll(".filtro-btn");
      const condiciones = document.querySelectorAll(".condicion-btn");

      let filtrosActivos = Array.from(filtros).map(btn => btn.dataset.tipo);
      let condicionesActivas = Array.from(condiciones).map(btn => btn.dataset.condicion);
      let rivalSeleccionado = "";

      // cargar clubes din치micamente
      const clubes = await cargarCSVClubes();
      const filtroRival = document.getElementById("filtro-rival");
      clubes.forEach(club => {
        const option = document.createElement("option");
        option.value = club;
        option.textContent = club;
        filtroRival.appendChild(option);
      });

      filtroRival.addEventListener("change", () => {
        rivalSeleccionado = filtroRival.value;
        const valor = buscador.value.trim();
        mostrarFilas(filas, valor, filtrosActivos, condicionesActivas, rivalSeleccionado);
      });

      filtros.forEach(btn => {
        btn.addEventListener("click", () => {
          const tipo = btn.dataset.tipo;
          btn.classList.toggle("inactivo");
          if (btn.classList.contains("inactivo")) {
            filtrosActivos = filtrosActivos.filter(t => t !== tipo);
          } else {
            filtrosActivos.push(tipo);
          }
          const valor = buscador.value.trim();
          mostrarFilas(filas, valor, filtrosActivos, condicionesActivas, rivalSeleccionado);
        });
      });

      condiciones.forEach(btn => {
        btn.addEventListener("click", () => {
          const cond = btn.dataset.condicion;
          btn.classList.toggle("inactivo");
          if (btn.classList.contains("inactivo")) {
            condicionesActivas = condicionesActivas.filter(c => c !== cond);
          } else {
            condicionesActivas.push(cond);
          }
          const valor = buscador.value.trim();
          mostrarFilas(filas, valor, filtrosActivos, condicionesActivas, rivalSeleccionado);
        });
      });

      buscador.addEventListener("input", () => {
        const valor = buscador.value.trim();
        mostrarFilas(filas, valor, filtrosActivos, condicionesActivas, rivalSeleccionado);
      });

      // al inicio no mostramos nada
      mostrarFilas(filas, "", filtrosActivos, condicionesActivas, rivalSeleccionado);
    });
  </script>
</body>
</html>
